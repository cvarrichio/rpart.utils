rpart.lists(crs$rpart)
rpart.lists(fit)
fit$frame
print("ncat=")
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
print ("Whichrow = ")
print(whichrow)
print("vnames = ")
print(vnames)
print("index = ")
print(index)
print("irow = ")
print(irow)
print("ncat=")
print(ncat)
if (any(ncat > 1L)) {               # any categorical variables ?
xlevels <- attr(object, "xlevels")
##
## jrow will be the row numbers of factors within lsplit and rsplit
## crow the row number in "csplit"
## and cindex the index on the "xlevels" list
##
jrow <- seq_along(ncat)[ncat > 1L]
crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
return(results)
}
}
rpart.lists(fit)
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
print ("Whichrow = ")
print(whichrow)
print("vnames = ")
print(vnames)
print("index = ")
print(index)
print("irow = ")
print(irow)
print("ncat=")
print(ncat)
print(lsplit)
print(rsplit)
if (any(ncat > 1L)) {               # any categorical variables ?
xlevels <- attr(object, "xlevels")
##
## jrow will be the row numbers of factors within lsplit and rsplit
## crow the row number in "csplit"
## and cindex the index on the "xlevels" list
##
jrow <- seq_along(ncat)[ncat > 1L]
crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
return(results)
}
}
rpart.lists(fit)
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
#     print ("Whichrow = ")
#     print(whichrow)
#     print("vnames = ")
#     print(vnames)
#     print("index = ")
#     print(index)
#     print("irow = ")
#     print(irow)
#     print("ncat=")
#     print(ncat)
print(lsplit)
print(rsplit)
if (any(ncat > 1L)) {               # any categorical variables ?
xlevels <- attr(object, "xlevels")
##
## jrow will be the row numbers of factors within lsplit and rsplit
## crow the row number in "csplit"
## and cindex the index on the "xlevels" list
##
jrow <- seq_along(ncat)[ncat > 1L]
crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
print(lsplit)
print(rsplit)
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
return(results)
}
}
rpart.lists(fit)
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
#     print ("Whichrow = ")
#     print(whichrow)
#     print("vnames = ")
#     print(vnames)
#     print("index = ")
#     print(index)
#     print("irow = ")
#     print(irow)
#     print("ncat=")
#     print(ncat)
print(lsplit)
print(rsplit)
#   if (any(ncat > 1L)) {               # any categorical variables ?
#     xlevels <- attr(object, "xlevels")
#     ##
#     ## jrow will be the row numbers of factors within lsplit and rsplit
#     ## crow the row number in "csplit"
#     ## and cindex the index on the "xlevels" list
#     ##
#     jrow <- seq_along(ncat)[ncat > 1L]
#     crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
#     cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
#
#
#     lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
#     rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
print(lsplit)
print(rsplit)
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
return(results)
}
}
#   print(lsplit)
#   print(rsplit)
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
#     print ("Whichrow = ")
#     print(whichrow)
#     print("vnames = ")
#     print(vnames)
#     print("index = ")
#     print(index)
#     print("irow = ")
#     print(irow)
#     print("ncat=")
#     print(ncat)
#   print(lsplit)
#   print(rsplit)
if (any(ncat > 1L))
{               # any categorical variables ?
xlevels <- attr(object, "xlevels")
##
## jrow will be the row numbers of factors within lsplit and rsplit
## crow the row number in "csplit"
## and cindex the index on the "xlevels" list
##
jrow <- seq_along(ncat)[ncat > 1L]
crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
}
return(results)
}
rpart.lists(fit)
#' Creates lists of variable values (factor levels) associated with each rule in an rpart object.
#'
#'
#' @param object an rpart object
#' @return a list of lists
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.lists(fit)
rpart.lists <- function(object)
{
ff <- object$frame
n <- nrow(ff)
if (n == 1L) return("root")            # special case of no splits
is.leaf <- (ff$var == "<leaf>")
whichrow <- !is.leaf
vnames <- ff$var[whichrow] # the variable names for the primary splits
index <- cumsum(c(1, ff$ncompete + ff$nsurrogate + !is.leaf))
irow <- index[c(whichrow, FALSE)] # we only care about the primary split
ncat <- object$splits[irow, 2L]
lsplit <- rsplit <- list()
## Now to work: first create labels for the left and right splits,
##  but not for leaves of course
##
#
if (any(ncat < 2L)) {               # any continuous vars ?
jrow <- irow[ncat < 2L]
cutpoint <- object$splits[jrow, 4L]
temp1 <- (ifelse(ncat < 0, "<", ">="))[ncat < 2L]
temp2 <- (ifelse(ncat < 0, ">=", "<"))[ncat < 2L]
lsplit[ncat<2L] <- cutpoint
#lsplit[ncat<2L] <- lapply(lsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
rsplit[ncat<2L] <- cutpoint
#rsplit[ncat<2L] <- lapply(rsplit[ncat<2L],function (x) structure(x, 'numeric'=TRUE))
}
#     print ("Whichrow = ")
#     print(whichrow)
#     print("vnames = ")
#     print(vnames)
#     print("index = ")
#     print(index)
#     print("irow = ")
#     print(irow)
#     print("ncat=")
#     print(ncat)
#   print(lsplit)
#   print(rsplit)
if (any(ncat > 1L))
{               # any categorical variables ?
xlevels <- attr(object, "xlevels")
##
## jrow will be the row numbers of factors within lsplit and rsplit
## crow the row number in "csplit"
## and cindex the index on the "xlevels" list
##
jrow <- seq_along(ncat)[ncat > 1L]
crow <- object$splits[irow[ncat > 1L], 4L] #row number in csplit
cindex <- (match(vnames, names(xlevels)))[ncat > 1L]
lsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==1L])
rsplit[jrow]<-lapply(seq_along(jrow),function (i) xlevels[[cindex[i]]][object$csplit[crow[i], ]==3L])
}
lsplit<-lapply(seq_along(lsplit), function (i) structure(lsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,"<",">="),"=")))
rsplit<-lapply(seq_along(lsplit), function (i) structure(rsplit[[i]], "compare"=ifelse(ncat[i]<2L,ifelse(ncat[i]<0,">=","<"),"=")))
names(lsplit)<-vnames
names(rsplit)<-vnames
results<-list("L"=lsplit,"R"=rsplit)
return(results)
}
rpart.lists(fit)
rpart.rules(fit)
rpart.subrules.table(fit)
fit
library(rpart.utils)
roxygenize(package.dir='.')
library("devtools")
install.packages("devtools")
install.packages("devtools")
library(devtools)
devtools::create_description('.')
devtools::create_description('.')
devtools::create_description('.')
?description
??description
library(rpart.utils)
library(rpart.utils)
library(rpart.utils)
install.packages("texi2dvi")
??texi
install.packages("devtools",dependencies=c("Depends","Suggests"))
install.packages("tools",dependencies=c("Depends","Suggests"))
install.packages("tools", dependencies = c("Depends", "Suggests"))
install.packages("tools", dependencies = c("Depends", "Suggests"))
install.packages("tools", dependencies = c("Depends", "Suggests"))
tools::texi2pdf
library(tools)
library(rpart.utils)
Sys.which("pdflatex")
Sys.getenv("PATH")
Sys.setenv(PATH=paste(Sys.getenv("PATH"),"/Program Files/MiKTeX 2.9/miktex/bin/x64/",sep=":"))
Sys.getenv("PATH")
Sys.which("pdflatex")
library(rpart.utils)
Sys.which("pdflatex")
Sys.which("pdflatex")<-"hello"
Sys.which("pdflatex")<-"/Program Files/MiKTeX 2.9/miktex/bin/x64/pdflatex.exe"
Sys.which("pdflatex")
library(rpart)
data()
car90
rpart(Reliability~.,data=car90)
fit<-rpart(Reliability~.,data=car90)
library(rpart.utils)
rpart.rules(fit)
rpart.subrules(fit)
rpart.subrules.table(fit)
fit$ff
fit$frame
rpart.rules.table(fit)
#' Returns an unpivoted table of branch paths (subrules) associated with each node.
#'
#'
#' @param object an rpart object
#' @export
#' @examples
#' library(rpart)
#' fit <- rpart(Kyphosis ~ Age + Number + Start, data = kyphosis)
#' rpart.rules.table(fit)
rpart.rules.table<-function(object)
{
rules<-rpart.rules(object)
ff<-object$frame
ff$rules<-unlist(rules[as.numeric(row.names(ff))])
# print(Reduce(cbind,lapply(ff,identity)))
ruleList<-lapply(row.names(ff),function (name) setNames(data.frame(name,
(strsplit(ff[name,'rules'],split=',')),
ff[name,'var']=="<leaf>"
),
c("Rule","Subrule","Leaf")))
combinedRules<-Reduce(rbind,ruleList)
return(combinedRules)
}
rpart.rules.table(fit)
cbind(rpart.rules.table(fit),fit$frame)
cbind(rpart.rules.table(fit),fit$frame$yval)
cbind(rpart.rules.table(fit),fit$frame$yval2)
rpart.lists(fit)
fit<-rpart(Reliability~.,data=car90)
fit
table(car90$Reliability)
?car90
rpart.rules.table(fit)
rpart.subrules.table(fit)
?rpart
library(rpart)
?rpart
??gbm
